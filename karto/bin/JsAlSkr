#!/bin/sh
#####################################
# Legas una variablo de «json» file.
# ĉi tiu linio devas esti tia:
#   variablo=[{"name":"RAPIDECO","value":"500"},....
# kaj montras «nomo=valoro» por permesi kreadon de la responda bash-skripto. 
#####################################

FIC=$1
VAR=$2
MAX=100
if [ $# -gt 2 ]
then
  MAX=$3
fi

data=$( cat $FIC| (
 while read xx
 do
  data=$(echo "$xx"|grep -E "^(var)* *${VAR}="|sed -E "s/^(var)* *${VAR}=//;s/ *; *$//")
  if [ "x$data" != "x" ]
  then
   # linio kun variablo trovita
   break
  fi
 done 
 while read xx
 do
  data="$data$xx"
 done 
 echo $data
 )
) 

for i in $(seq 0 $MAX)
do
  couple=$(echo "$data"|jq -r '.['$i']' 2>/dev/null)
  nomo=$(echo "$couple"|jq -r '.name'|sed 's/[\.\[]//g;s/\]//g' )
  valoro=$(echo "$couple"|jq -r '.value' )
  if [ "x$nomo" = "xnull" -o "x$nomo" = "x" ]
  then
    break
  fi
  echo $nomo="$valoro"
  #export $nomo="$valoro"
done
